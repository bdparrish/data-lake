
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>docs: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">github.com/codingexplorations/data-lake/object-service/docs/docs.go (0.0%)</option>
				
				<option value="file1">github.com/codingexplorations/data-lake/object-service/main.go (0.0%)</option>
				
				<option value="file2">github.com/codingexplorations/data-lake/object-service/pkg/controller/objects-controller.go (66.7%)</option>
				
				<option value="file3">github.com/codingexplorations/data-lake/object-service/pkg/repository/objects-repository.go (40.0%)</option>
				
				<option value="file4">github.com/codingexplorations/data-lake/object-service/pkg/route/routes.go (100.0%)</option>
				
				<option value="file5">github.com/codingexplorations/data-lake/object-service/test/mocks/repository/object-repository.go (20.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">// Package docs Code generated by swaggo/swag. DO NOT EDIT
package docs

import "github.com/swaggo/swag"

const docTemplate = `{
    "schemes": {{ marshal .Schemes }},
    "swagger": "2.0",
    "info": {
        "description": "{{escape .Description}}",
        "title": "{{.Title}}",
        "termsOfService": "http://swagger.io/terms/",
        "contact": {},
        "version": "{{.Version}}"
    },
    "host": "{{.Host}}",
    "basePath": "{{.BasePath}}",
    "paths": {
        "/": {
            "get": {
                "description": "Queries the API for objects and details.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "object"
                ],
                "summary": "Get objects in the system. Utilize page and size to paginate through the list of objects. Page and size are optional as the defaults for the system will be used.",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Page",
                        "name": "page",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "description": "Page Size",
                        "name": "size",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/proto.Object"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "proto.Object": {
            "type": "object",
            "properties": {
                "content_size": {
                    "description": "int32 4,294,967,295 or int64 9,223,372,036,854,775,807",
                    "type": "integer"
                },
                "content_type": {
                    "type": "string"
                },
                "file_location": {
                    "type": "string"
                },
                "file_name": {
                    "type": "string"
                },
                "id": {
                    "type": "string"
                }
            }
        }
    }
}`

// SwaggerInfo holds exported Swagger Info so clients can modify it
var SwaggerInfo = &amp;swag.Spec{
        Version:          "0.0.1",
        Host:             "",
        BasePath:         "/api/object/",
        Schemes:          []string{},
        Title:            "Object Service",
        Description:      "Object service for core object operations.",
        InfoInstanceName: "swagger",
        SwaggerTemplate:  docTemplate,
        LeftDelim:        "{{",
        RightDelim:       "}}",
}

func init() <span class="cov0" title="0">{
        swag.Register(SwaggerInfo.InstanceName(), SwaggerInfo)
}</span>
</pre>
		
		<pre class="file" id="file1" style="display: none">package main

import (
        "fmt"
        "os"

        "github.com/codingexplorations/data-lake/common/pkg/config"
        "github.com/codingexplorations/data-lake/common/pkg/db"
        "github.com/codingexplorations/data-lake/common/pkg/log"
        "github.com/codingexplorations/data-lake/object-service/pkg/controller"
        "github.com/codingexplorations/data-lake/object-service/pkg/repository"
        "github.com/codingexplorations/data-lake/object-service/pkg/route"
        "github.com/gin-gonic/gin"
)

// @title                        Object Service
// @version                0.0.1
// @description        Object service for core object operations.
// @termsOfService        http://swagger.io/terms/
// @BasePath                /api/object/
func main() <span class="cov0" title="0">{
        conf := config.GetConfig()

        logger, err := log.GetLogger()
        if err != nil </span><span class="cov0" title="0">{
                panic("failed to get logger")</span>
        }

        <span class="cov0" title="0">store := db.NewPostgresDb(conf)

        repo := repository.NewObjectRepository(logger, conf, store)

        objectController := controller.NewObjectController(logger, repo)

        engine := gin.New()
        route.RegisterRoutes(engine, *objectController)
        engine.Use(gin.Recovery())

        err = engine.Run(fmt.Sprintf(":%d", 8000))
        if err != nil </span><span class="cov0" title="0">{
                logger.Error(fmt.Sprintf("error in starting gin engine: %v", err.Error()))
                os.Exit(2)
        }</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package controller

import (
        "fmt"
        "net/http"
        "strconv"

        "github.com/bufbuild/protovalidate-go"
        "github.com/codingexplorations/data-lake/common/pkg/converter"
        "github.com/codingexplorations/data-lake/common/pkg/log"
        "github.com/codingexplorations/data-lake/common/pkg/models/v1/db"
        "github.com/codingexplorations/data-lake/common/pkg/models/v1/proto"
        "github.com/codingexplorations/data-lake/object-service/pkg/repository"
        "github.com/gin-gonic/gin"
        "google.golang.org/protobuf/encoding/protojson"
)

type ObjectController struct {
        repository      repository.ObjectRepository[db.Object]
        logger          log.Logger
        marshaller      protojson.MarshalOptions
        protoValidator  *protovalidate.Validator
        objectConverter converter.GenericConverter[proto.Object, db.Object]
}

func NewObjectController(
        logger log.Logger,
        repository repository.ObjectRepository[db.Object],
) *ObjectController <span class="cov8" title="1">{
        validator, err := protovalidate.New()
        if err != nil </span><span class="cov0" title="0">{
                logger.Error(fmt.Sprintf("error in creating proto validator: %v", err))
                return nil
        }</span>

        <span class="cov8" title="1">controller := ObjectController{
                repository: repository,
                logger:     logger,
                marshaller: protojson.MarshalOptions{
                        EmitUnpopulated: true,
                },
                protoValidator:  validator,
                objectConverter: converter.JsonMarshallingConverter[proto.Object, db.Object]{},
        }
        return &amp;controller</span>
}

// GetObjects godoc
//
//        @Summary                Get objects in the system. Utilize page and size to paginate through the list of objects. Page and size are optional as the defaults for the system will be used.
//        @Description        Queries the API for objects and details.
//        @Tags                        object
//        @Accept                        json
//        @Produce                json
//        @Param                        page        query        int        false        "Page"
//        @Param                        size        query        int        false        "Page Size"
//        @Success                200                object        proto.Object
//        @Router                        / [get]
func (controller *ObjectController) GetObjects(c *gin.Context) <span class="cov8" title="1">{
        page, err := strconv.Atoi(c.DefaultQuery("page", "1"))
        if err != nil </span><span class="cov0" title="0">{
                controller.logger.Error(fmt.Sprintf("error in parsing page: %v", err))
                return
        }</span>
        <span class="cov8" title="1">size, err := strconv.Atoi(c.DefaultQuery("size", "10"))
        if err != nil </span><span class="cov0" title="0">{
                controller.logger.Error(fmt.Sprintf("error in parsing size: %v", err))
                return
        }</span>

        <span class="cov8" title="1">objects, err := controller.repository.GetAll(page, size)
        if err != nil </span><span class="cov0" title="0">{
                controller.logger.Error(fmt.Sprintf("error in getting objects: %v", err))
                return
        }</span>

        <span class="cov8" title="1">if len(objects) == 0 </span><span class="cov8" title="1">{
                c.Data(http.StatusOK, "application/json", []byte{})
                return
        }</span>

        <span class="cov8" title="1">protoObjects, err := controller.objectConverter.DbToProtoSlice(objects)
        if err != nil </span><span class="cov0" title="0">{
                controller.logger.Error(fmt.Sprintf("error in converting db objects to proto objects: %v", err))
        }</span>

        <span class="cov8" title="1">response := proto.ObjectGetAllResponse{
                Objects: protoObjects,
        }

        payload, _ := controller.marshaller.Marshal(&amp;response)
        c.Data(http.StatusOK, "application/json", payload)</span>
}
</pre>
		
		<pre class="file" id="file3" style="display: none">package repository

import (
        "github.com/codingexplorations/data-lake/common/pkg/config"
        "github.com/codingexplorations/data-lake/common/pkg/log"
        "github.com/codingexplorations/data-lake/common/pkg/models/v1/db"
        "github.com/google/uuid"
        "gorm.io/gorm"
)

// ObjectRepository is the interface to handle CRUD operations for object model.
type ObjectRepository[T db.Object] interface {
        GetAll(page int, size int) ([]*T, error)
        Get(uuid uuid.UUID) (*T, error)
        Insert(record *T) (*T, error)
        Update(record *T) (*T, error)
        Delete(uuid uuid.UUID) (*T, error)
}

// ObjectRepositoryImpl is the struct to support the ObjectRepository methods.
type ObjectRepositoryImpl struct {
        Logger log.Logger
        Conf   *config.Config
        DB     *gorm.DB
}

// NewObjectRepository constructor for a new object repository
func NewObjectRepository(logger log.Logger, conf *config.Config, store *gorm.DB) ObjectRepositoryImpl <span class="cov8" title="1">{
        return ObjectRepositoryImpl{
                Logger: logger,
                Conf:   conf,
                DB:     store,
        }
}</span>

func (repo ObjectRepositoryImpl) GetAll(page int, size int) ([]*db.Object, error) <span class="cov8" title="1">{
        offset := (page - 1) * size
        var results []*db.Object
        if err := repo.DB.
                Model(&amp;db.Object{}).
                Limit(size).
                Offset(offset).
                Find(&amp;results).
                Error; err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return results, nil</span>
}

func (repo ObjectRepositoryImpl) Get(id uuid.UUID) (*db.Object, error) <span class="cov8" title="1">{
        var result db.Object
        if err := repo.DB.
                Model(&amp;db.Object{}).
                Where("id = ?", id).
                First(&amp;result).
                Error; err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov8" title="1">return &amp;result, nil</span>
}

func (repo ObjectRepositoryImpl) Insert(record *db.Object) (*db.Object, error) <span class="cov0" title="0">{
        if err := repo.DB.
                Model(&amp;db.Object{}).
                Create(record).
                Error; err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">return record, nil</span>
}

func (repo ObjectRepositoryImpl) Update(record *db.Object) (*db.Object, error) <span class="cov0" title="0">{
        if err := repo.DB.
                Model(&amp;db.Object{}).
                Where("id = ?", record.Id).
                Updates(record).
                Error; err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">return record, nil</span>
}

func (repo ObjectRepositoryImpl) Delete(id uuid.UUID) (*db.Object, error) <span class="cov0" title="0">{
        var result db.Object
        if err := repo.DB.
                Model(&amp;db.Object{}).
                Where("id = ?", id).
                Delete(&amp;result).
                Error; err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">return &amp;result, nil</span>
}
</pre>
		
		<pre class="file" id="file4" style="display: none">package route

import (
        "github.com/codingexplorations/data-lake/object-service/pkg/controller"
        "github.com/gin-gonic/gin"
        swaggerFiles "github.com/swaggo/files"
        ginSwagger "github.com/swaggo/gin-swagger"
)

func RegisterRoutes(
        router *gin.Engine,
        controller controller.ObjectController,
) <span class="cov8" title="1">{
        api := router.Group("/api/object")
        </span><span class="cov8" title="1">{
                api.GET("/", controller.GetObjects)
        }</span>

        <span class="cov8" title="1">router.GET(
                "/docs/*any",
                ginSwagger.WrapHandler(
                        swaggerFiles.Handler,
                        ginSwagger.DefaultModelsExpandDepth(1),
                        ginSwagger.DocExpansion("list"),
                        ginSwagger.DeepLinking(true),
                ),
        )</span>
}
</pre>
		
		<pre class="file" id="file5" style="display: none">// Code generated by mockery v2.42.3. DO NOT EDIT.

package repository

import (
        db "github.com/codingexplorations/data-lake/common/pkg/models/v1/db"
        mock "github.com/stretchr/testify/mock"

        uuid "github.com/google/uuid"
)

// ObjectRepository is an autogenerated mock type for the ObjectRepository type
type ObjectRepository[T interface{ db.Object }] struct {
        mock.Mock
}

// Delete provides a mock function with given fields: _a0
func (_m *ObjectRepository[T]) Delete(_a0 uuid.UUID) (*T, error) <span class="cov0" title="0">{
        ret := _m.Called(_a0)

        if len(ret) == 0 </span><span class="cov0" title="0">{
                panic("no return value specified for Delete")</span>
        }

        <span class="cov0" title="0">var r0 *T
        var r1 error
        if rf, ok := ret.Get(0).(func(uuid.UUID) (*T, error)); ok </span><span class="cov0" title="0">{
                return rf(_a0)
        }</span>
        <span class="cov0" title="0">if rf, ok := ret.Get(0).(func(uuid.UUID) *T); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*T)
                }</span>
        }

        <span class="cov0" title="0">if rf, ok := ret.Get(1).(func(uuid.UUID) error); ok </span><span class="cov0" title="0">{
                r1 = rf(_a0)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// Get provides a mock function with given fields: _a0
func (_m *ObjectRepository[T]) Get(_a0 uuid.UUID) (*T, error) <span class="cov0" title="0">{
        ret := _m.Called(_a0)

        if len(ret) == 0 </span><span class="cov0" title="0">{
                panic("no return value specified for Get")</span>
        }

        <span class="cov0" title="0">var r0 *T
        var r1 error
        if rf, ok := ret.Get(0).(func(uuid.UUID) (*T, error)); ok </span><span class="cov0" title="0">{
                return rf(_a0)
        }</span>
        <span class="cov0" title="0">if rf, ok := ret.Get(0).(func(uuid.UUID) *T); ok </span><span class="cov0" title="0">{
                r0 = rf(_a0)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*T)
                }</span>
        }

        <span class="cov0" title="0">if rf, ok := ret.Get(1).(func(uuid.UUID) error); ok </span><span class="cov0" title="0">{
                r1 = rf(_a0)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetAll provides a mock function with given fields: page, size
func (_m *ObjectRepository[T]) GetAll(page int, size int) ([]*T, error) <span class="cov8" title="1">{
        ret := _m.Called(page, size)

        if len(ret) == 0 </span><span class="cov0" title="0">{
                panic("no return value specified for GetAll")</span>
        }

        <span class="cov8" title="1">var r0 []*T
        var r1 error
        if rf, ok := ret.Get(0).(func(int, int) ([]*T, error)); ok </span><span class="cov0" title="0">{
                return rf(page, size)
        }</span>
        <span class="cov8" title="1">if rf, ok := ret.Get(0).(func(int, int) []*T); ok </span><span class="cov0" title="0">{
                r0 = rf(page, size)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).([]*T)
                }</span>
        }

        <span class="cov8" title="1">if rf, ok := ret.Get(1).(func(int, int) error); ok </span><span class="cov0" title="0">{
                r1 = rf(page, size)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// Insert provides a mock function with given fields: record
func (_m *ObjectRepository[T]) Insert(record *T) (*T, error) <span class="cov0" title="0">{
        ret := _m.Called(record)

        if len(ret) == 0 </span><span class="cov0" title="0">{
                panic("no return value specified for Insert")</span>
        }

        <span class="cov0" title="0">var r0 *T
        var r1 error
        if rf, ok := ret.Get(0).(func(*T) (*T, error)); ok </span><span class="cov0" title="0">{
                return rf(record)
        }</span>
        <span class="cov0" title="0">if rf, ok := ret.Get(0).(func(*T) *T); ok </span><span class="cov0" title="0">{
                r0 = rf(record)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*T)
                }</span>
        }

        <span class="cov0" title="0">if rf, ok := ret.Get(1).(func(*T) error); ok </span><span class="cov0" title="0">{
                r1 = rf(record)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// Update provides a mock function with given fields: record
func (_m *ObjectRepository[T]) Update(record *T) (*T, error) <span class="cov0" title="0">{
        ret := _m.Called(record)

        if len(ret) == 0 </span><span class="cov0" title="0">{
                panic("no return value specified for Update")</span>
        }

        <span class="cov0" title="0">var r0 *T
        var r1 error
        if rf, ok := ret.Get(0).(func(*T) (*T, error)); ok </span><span class="cov0" title="0">{
                return rf(record)
        }</span>
        <span class="cov0" title="0">if rf, ok := ret.Get(0).(func(*T) *T); ok </span><span class="cov0" title="0">{
                r0 = rf(record)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*T)
                }</span>
        }

        <span class="cov0" title="0">if rf, ok := ret.Get(1).(func(*T) error); ok </span><span class="cov0" title="0">{
                r1 = rf(record)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// NewObjectRepository creates a new instance of ObjectRepository. It also registers a testing interface on the mock and a cleanup function to assert the mocks expectations.
// The first argument is typically a *testing.T value.
func NewObjectRepository[T interface{ db.Object }](t interface {
        mock.TestingT
        Cleanup(func())
}) *ObjectRepository[T] <span class="cov8" title="1">{
        mock := &amp;ObjectRepository[T]{}
        mock.Mock.Test(t)

        t.Cleanup(func() </span><span class="cov8" title="1">{ mock.AssertExpectations(t) }</span>)

        <span class="cov8" title="1">return mock</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
